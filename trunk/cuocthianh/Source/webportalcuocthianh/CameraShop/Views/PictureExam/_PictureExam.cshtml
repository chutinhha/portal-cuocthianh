
@model CoreData.PictureExam
           <script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.js")" type="text/javascript"></script>
@*@using (Ajax.BeginForm("UploadPicture", "PictureExam", new AjaxOptions { OnSuccess = "Success", HttpMethod = "Post" }, new { enctype = "multipart/form-data", @id = "validation" }))
{*@
<div style="padding:10px; font-size:x-large">
    Upload hình ảnh
</div>
<div style="padding:10px;">
    Lưu ý: Chờ cho tới khi ảnh được upload xong , sau đó tiếp tục bấm vào nút "Upload Ảnh" bên dưới để hoàn thành thao tác
</div>
    @Html.HiddenFor(model => model.ID)
   <input type="hidden" id="txtexid" value="@Session["ExamineeID"].ToString()" />
   @if (Helper.SessionManagement.GetSessionReturnToString("uploadover") == null)
   {
    <div class="std">
        <ul>
            <li>
                <label>
                    Tiêu đề:</label>
                @Html.TextBoxFor(m => m.Title, new { @class = "txt" })</li>
            <li>
             <label>
                    Hình ảnh:</label>
                <input id="fileupload" type="file" name="file" />
                @if (Model != null && Model.Image != null && Model.Image != "")
                {
                    <div id="image">
                        <img src="@Url.Content("~/Media/PictureExam/" + Model.Image)" width="120px" height="120px" alt="@Model.Image" />
                    </div>
                }
                else
                {
                    <div id="image">
                    </div>
                }
                <div id="processimg"></div>
            </li>
            
        </ul>
        @*<div class="control-apply">
            <input id="btn-change-infor" class="button button-color-1 cmdaddimage" type="submit" value="Thêm ảnh">
        </div>*@
    </div>  
   }
@*}*@
<script type="text/javascript">
    ///Document Ready jQuery
    $(document).ready(function () {

        $('#fileupload').fileupload({
            dataType: 'json',
            url: '/PictureExam/UploadFiles?dir=PictureExam',
            autoUpload: true,
            done: function (e, data) {
                $('#image').html('<img width=\"120px\" height=\"120px\" src="/Media/PictureExam/' + data.result.name + '" />');
                $('#processimg').html('');
                $("#btn-updateintroduce").show();
            }
        }).on('fileuploadprogressall', function (e, data) {

            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('.progress .progress-bar').css('width', progress + '%');
            $('#processimg').html('Đang upload.....');
            $("#btn-updateintroduce").hide();
        });

    });



//    function loadpicture() {
//        $.ajax({
//            type: 'get',
//            url: '/PictureExam/_ListPictureExamProfile/',
//            traditional: true,
//            dataType: 'html',
//            complete: function (edata) {
//                $("#listpicture").html(edata.responseText);
//                
//            }
//        });

//    }


//    $.fn.uppicture = function () {
//        $(this).on("click", function () {
//            var title = $("#Title").val();
//            var exid = $("#txtexid").val();

//            if (title == "") {
//                //alert
//            }
//            $.ajax({
//                type: "POST",
//                url: '/PictureExam/UploadPicture/',
//                data: {
//                    ExamineeID: exid,
//                    Title: title

//                },
//                traditional: true,
//                dataType: 'json',
//                success: function (e) {
//                    if (e != "-1" && !isNaN(e)) {
//                        $('#image').html('');
//                        $('#Title').val('');
//                        loadpicture();
//                        UpdateDescription();
//                        alert("Upload ảnh thành công");



//                    }
//                    else if (isNaN(e)) {
//                        $('#Title').val('');
//                        $('#image').html('');
//                        alert(e);
//                    }
//                    else {
//                        $('#Title').val('');
//                        $('#image').html('');
//                        alert("Lỗi, vui lòng thử lại");
//                    }
//                }
//            });
//        });
//    }

//    function UpdateDescription() {


//        var content = $("div.nicEdit-main").html();

//        $.ajax({
//            type: "POST",
//            url: '/Examinee/UpdateDescription/',
//            data: {
//                content: content

//            },
//            traditional: true,
//            dataType: 'json',
//            complete: function (e) {
//                if (e.responseText == "OK") {

//                  //  alert("Cập nhật thành công");
//                }
//                else {
//                   // alert("Lỗi, vui lòng thử lại");
//                }
//            }
//        });

//    }


  //  $(".cmdaddimage").uppicture();
//    $("#btn-updateintroduce").uppicture();
</script>
