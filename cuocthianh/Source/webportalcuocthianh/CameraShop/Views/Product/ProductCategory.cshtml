@using CoreData
@using Helper
@model IList<Product>
@{
    if (Model.Count > 0)
    {
        ViewBag.Title = Model.First().CategoryNameExt;
    }
    else
    {
        ViewBag.Title = ViewBag.Title;
    }
    Layout = "~/Views/Shared/_Layout.cshtml";   
}
@helper pagerHelper()
    {
        int totalPage = Model.FirstOrDefault().TotalPageExt;
        int currentPage = (int)Model.First().pageExt;
        int i = 0;

        long tempcatID = 0;
        if (Model.FirstOrDefault().CategoryNameExt == "")
        {
            tempcatID = 0;
        }
        else
        {
            tempcatID = Model.FirstOrDefault().CateID;
        }      
    <ul>
        <li class="bullet-first"><a href="@Url.RouteUrl("category_details", new { Id = Model.First().CateID, Link = Model.First().CategoryExt.Link })">
            <<</a></li>
        @if (currentPage > 1)
        {
            <li class="bullet-prev"><a href="@Url.RouteUrl("category_details", new { Id = Model.First().CateID, Link = Model.First().CategoryExt.Link, page = currentPage - 1 })">
                <</a></li>
        }
        @if (totalPage > 0)
        {
            var startPage = currentPage - 2;
            var endPage = currentPage + 2;
            if (startPage < 1) { startPage = 1; }
            if (endPage > totalPage) { endPage = totalPage; }

            if (currentPage >= 4)
            {
            <li>...</li>
            }
            for (i = startPage; i <= endPage; i++)
            {
                if (currentPage == i)
                {
            <li class="current-page"><a href="@Url.RouteUrl("category_details", new { Id = Model.First().CateID, Link = Model.First().CategoryExt.Link, page = i })">@i</a></li>
                }
                else
                {
            <li><a href="@Url.RouteUrl("category_details", new { Id = Model.First().CateID, Link = Model.First().CategoryExt.Link, page = i })">@i</a></li>
                }
            }
            if (currentPage <= totalPage - 2)
            {
            <li>...</li>
            }
        }
        @if (currentPage < totalPage)
        {
            <li class="bullet-next"><a href="@Url.RouteUrl("category_details", new { Id = Model.First().CateID, Link = Model.First().CategoryExt.Link, page = currentPage + 1 })">
                ></a></li>
        }
        <li class="bullet-last"><a href="@Url.RouteUrl("category_details", new { Id = Model.First().CateID, Link = Model.First().CategoryExt.Link, page = totalPage })">
            >></a></li>
    </ul>
}
@section HeadResource{
    <title>Danh mục @ViewBag.Title</title>
    <link rel="stylesheet" type="text/css" href="@Url.Content("~/Content/css/category.css")">
}
@section BottomResource{
    <script type="text/javascript" src="@Url.Content("~/Content/js/category.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/Content/plugins/belloSlideShow/js/belloSlideShow.js")" ></script>
}
@section BreadCrumb{
    @if (Model.Count() > 0)
    {
        @Html.Action("_BreadCrumb", "Product", new { @Id = Model.First().CateID });
    }
    else
    {
        try
        {
            var CatId = Convert.ToInt64(ViewBag.CatId);
        @Html.Action("_BreadCrumb", "Product", new { @Id = CatId });
        }
        catch
        {
        }
    }
}
<div class="main-content">
    <div class="grid-row">
        <div class="grid-left-module">
            @if (Model.Count() > 0)
            {
                <div class="left-module">
                    <div class="module-head">
                        <h4 class="active">
                            Mục @ViewBag.Title</h4>
                    </div>
                    <div class="left-category">
                        @Html.Action("_GetChildCategory", "Category", new { @CatId = Model.First().CateID })
                    </div>
                </div>
                
                <div class="left-module saleSlide">
                    <div class="module-head">
                        <h4>
                            Khuyến mãi</h4>
                    </div>
                    <div class="slide-block-image">
                        <ul class="inner-module">
                            @if (Model != null && Model.Count() > 0)
                            {
                                var listDiscount = Model.Where(x => x.Discount > 0 && x.DiscountTo >= DateTime.Now);
                                if (listDiscount != null && listDiscount.Count() > 0)
                                {
                                    foreach (var item in listDiscount)
                                    {
                                        var percent = ((float)item.Discount / item.Price) * 100;
                                        string sTrPercent = ((int)percent).ToString() + "%";
                                <li class="slide-item"><a href="@Url.RouteUrl("product_details", new { Id = item.ID, Link = item.Link })" target="_blank">
                                    <img src="@Url.Content("~/Media/Product/" + @item.Image + "")" alt="@item.Image" />
                                </a>
                                    <div class="discount-percent">
                                        <label>
                                            Giảm</label>
                                        <span>@sTrPercent</span>
                                    </div>
                                    <div class="slide-item-infor">
                                        <a href="@Url.RouteUrl("product_details", new { Id = item.ID, Link = item.Link })" target="_blank">@item.Name</a>
                                        <div class="sprice-block">
                                            <span class="discount-sprice">@Helper.StringHelper.ConvertNumberToVietNamCurrency(item.Discount.ToString())</span>
                                            <span class="real-sprice">@Helper.StringHelper.ConvertNumberToVietNamCurrency(item.Price.ToString())</span>
                                        </div>
                                        <span class="discount-to">Đến ngày: @item.DiscountTo.ToString("dd/MM/yyyy")</span>
                                    </div>
                                </li>
                                    }
                                }
                                else
                                { 
                                @Html.Action("_ColumnBanner", "BannerLogo", new { @position = ValueDefine.BannerLogoPosition.LeftBanner, @CatId = Model.First().CateID })
                                }
                            }
                        </ul>
                    </div>
                </div>
                
                <div class="right-module saleSlide">
                    <div class="module-head">
                        <h4>
                            Dịch vụ khác</h4>
                    </div>
                    <div class="slide-block-image">
                        <ul class="inner-module">
                            @Html.Action("_ColumnBanner", "BannerLogo", new { @position = ValueDefine.BannerLogoPosition.RightBanner, @CatId = Model.First().CateID })
                        </ul>
                    </div>
                </div>
            }
        </div>
        <div class="center-module">
            @if (Model.Count() > 0)
            {
                <div class="search-tool">
                    <div class="search-left-tool">
                        <label>
                            Giá từ:</label>
                        <select id="priceFrom" class="select">
                            <option value="0">dưới 1 triệu</option>
                            <option value="1">1 triệu</option>
                            <option value="2">2 triệu</option>
                            <option value="3">3 triệu</option>
                            <option value="4">4 triệu</option>
                            <option value="5">5 triệu</option>
                            <option value="6">6 triệu</option>
                            <option value="7">7 triệu</option>
                            <option value="8">8 triệu</option>
                            <option value="9">9 triệu</option>
                            <option value="10">10 triệu</option>
                        </select>
                        <label>
                            đến
                        </label>
                        <select id="priceTo" class="select">
                            <option value="1">1 triệu</option>
                            <option value="2">2 triệu</option>
                            <option value="3">3 triệu</option>
                            <option value="4">4 triệu</option>
                            <option value="5">5 triệu</option>
                            <option value="6">6 triệu</option>
                            <option value="7">7 triệu</option>
                            <option value="8">8 triệu</option>
                            <option value="9">9 triệu</option>
                            <option value="10">10 triệu</option>
                            <option value="11">hơn 10 triệu</option>
                        </select>
                    </div>
                    <div class="search-right-tool">
                        <label>
                            Hiển thị
                        </label>
                        <select class="select page-count">
                            <option>12</option>
                            <option>20</option>
                            <option>28</option>
                            <option>36</option>
                        </select>
                    </div>
                </div>
                <ul class="inner-module">
                    @foreach (var item in Model)
                    {
                        <li class="grid-content-item slide-item">
                            <div class="block-item">
                                <a href="@Url.RouteUrl("product_details", new { Id = item.ID, Link = item.Link })">
                                    <img src="@Url.Content("~/Media/Product/" + @item.Image + "")" alt="@item.Image">
                                </a>
                                <div class="block-item-infor">
                                    <a href="@Url.RouteUrl("product_details", new { Id = item.ID, Link = item.Link })">@item.Name</a>
                                    <div class="sprice-block">
                                        <span class="discount-sprice">@Helper.StringHelper.ConvertNumberToVietNamCurrency(item.Price.ToString())</span>
                                        <span class="real-sprice">@Helper.StringHelper.ConvertNumberToVietNamCurrency(item.Discount.ToString())</span>
                                    </div>
                                </div>
                                <div class="tool-payment">
                                    <a href="@Url.Action("BuyNow", "ShoppingCart", new { ProductId = item.ID, Qty = 1 })" class="btn btn-pay">
                                        Mua ngay</a>
                                    <input type="button" ProductId=@item.ID Qty="1" type="button" class="btn btn-add-cart" title="Thêm vào giỏ hàng">
                                </div>
                            </div>
                        </li>
                    }
                </ul>
                <div class="clearfix">
                </div>
                <div class="module-foot">
                    <div class="link-to-all">
                        @pagerHelper()
                    </div>
                </div>
            }
            else
            {
                <div class="module-head">
                    <h4 class="active">
                        Danh sách @ViewBag.Title</h4>
                </div>
                <span class="grid-content-item">Không có sản phẩm nào trong danh mục @ViewBag.Title</span>
            }
        </div>
    </div>
</div>
