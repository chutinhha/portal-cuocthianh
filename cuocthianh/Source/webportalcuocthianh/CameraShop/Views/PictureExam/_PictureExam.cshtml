
@model CoreData.PictureExam
           <script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.js")" type="text/javascript"></script>
@*@using (Ajax.BeginForm("UploadPicture", "PictureExam", new AjaxOptions { OnSuccess = "Success", HttpMethod = "Post" }, new { enctype = "multipart/form-data", @id = "validation" }))
{*@
    @Html.HiddenFor(model => model.ID)
   <input type="hidden" id="txtexid" value="@Session["ExamineeID"].ToString()" />
    <div class="std">
        <ul>
            <li>
                <label>
                    Tiêu đề:</label>
                @Html.TextBoxFor(m => m.Title, new { @class = "txt" })</li>
            <li>
             <label>
                    Hình ảnh:</label>
                <input id="fileupload" type="file" name="file" />
                @if (Model != null && Model.Image != null && Model.Image != "")
                {
                    <div id="image">
                        <img src="@Url.Content("~/Media/PictureExam/" + Model.Image)" width="120px" height="120px" alt="@Model.Image" />
                    </div>
                }
                else
                {
                    <div id="image">
                    </div>
                }
            </li>
        </ul>
        <div class="control-apply">
            <input id="btn-change-infor" class="button button-color-1 cmdaddimage" type="submit" value="Thêm ảnh">
        </div>
    </div>  
@*}*@
<script type="text/javascript">
    ///Document Ready jQuery
    $(document).ready(function () {

        $('#fileupload').fileupload({
            dataType: 'json',
            url: '/PictureExam/UploadFiles?dir=PictureExam',
            autoUpload: true,
            done: function (e, data) {
                $('#image').html('<img width=\"120px\" height=\"120px\" src="/Media/PictureExam/' + data.result.name + '" />');

            }
        }).on('fileuploadprogressall', function (e, data) {
            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('.progress .progress-bar').css('width', progress + '%');
        });

    });



    function loadpicture() {

        $.ajax({
            type: "POST",
            url: '/PictureExam/_ListPictureExamProfile/',
            traditional: true,
            dataType: 'json',
            success: function (e) {
                $("#listpicture").innerHTML(e);
            }
        });

    }


    $.fn.uppicture = function () {
        $(this).on("click", function () {
            var title = $("#Title").val();
            var exid = $("#txtexid").val();

            if (title == "") {
                //alert
            }
            $.ajax({
                type: "POST",
                url: '/PictureExam/UploadPicture/',
                data: {
                    ExamineeID: exid,
                    Title: title

                },
                traditional: true,
                dataType: 'json',
                success: function (e) {
                    if (e != "-1") {
                        loadpicture();
                        alert("Upload ảnh thành công");
                    }
                    else {
                        alert("Lỗi, vui lòng thử lại");
                    }
                }
            });
        });
    }




    $(".cmdaddimage").uppicture();

</script>
